# Formal Specification: Automated Problem-Grading and Management Platform (Full-Stack React Version)

## Table of Contents
1. [Overview](#overview)
2. [Core Features](#core-features)
3. [Authentication & User Management](#authentication--user-management)
4. [Classroom Management & Settings](#classroom-management--settings)
5. [Problem Classes & Problems](#problem-classes--problems)
6. [Problem Generation (LLM Integration)](#problem-generation-llm-integration)
7. [Submission, Grading, and Mastery](#submission-grading-and-mastery)
8. [Grading Infrastructure & Job Status](#grading-infrastructure--job-status)
9. [File Uploads & Security](#file-uploads--security)
10. [Audit Logging](#audit-logging)
11. [Additional Security & Compliance](#additional-security--compliance)
12. [Frontend Requirements](#frontend-requirements)
13. [Backend & Infrastructure](#backend--infrastructure)
14. [Extensibility & Future Considerations](#extensibility--future-considerations)

---

## 1. Overview

This document specifies a web application for classroom management, problem generation, automated grading, and mastery-based progression, scalable to large single-class deployments. The system is built as a full-stack React application (frontend and backend) using Vite as the build tool and JavaScript/TypeScript as the primary language. The database is Amazon RDS with MySQL. Styling is accomplished with CSS, Tailwind, or Styled-Components. Hosting is on GitHub Pages for the frontend, with backend deployment handled as appropriate for a React-based Node.js backend.

---

## 2. Core Features

- Teachers create and administer classrooms and problem classes.
- Problems can be hand-authored or batch-generated by an LLM (Anthropic).
- Students submit code files, which are graded automatically against a test suite.
- Mastery is tracked per problem class, based on passing all test cases for a randomly assigned problem.
- Teachers and TAs have distinct roles and access levels.
- Audit logs, job status, and classroom-level settings enhance transparency and security.

---

## 3. Authentication & User Management

- **Authentication:** Simple username and password registration system.
  - Users create accounts using a chosen username and password.
  - Passwords are securely hashed and stored in the database.
  - Login and registration endpoints are provided.
  - Password reset functionality should be implemented (via email or security questions).
- **User Roles:**
  - **Teacher:** Creates/manages classrooms and content, configures LLM, views audit logs.
  - **Co-Teacher:** Same as TA.
  - **TA (Teaching Assistant):** Views student submission history and grading results only.
  - **Student:** Joins classrooms, submits code, views progression and grading results.
- **Role Assignment:**
  - Teachers create classrooms and receive admin rights.
  - Students self-signup using an access code.
  - Teachers assign students as TAs or co-teachers as needed.

---

## 4. Classroom Management & Settings

- **Classroom Creation:** By teachers only.
- **Access:** Students join via access code.
- **Settings (per classroom):**
  - Allowed file type(s) for all submissions (e.g., `.py`, `.java`).
  - Naming conventions for submissions (if desired).
  - Visibility settings for test cases/results.
  - Any other relevant classroom-specific rules or restrictions.
- **No artificial limits** on number of students per classroom.

---

## 5. Problem Classes & Problems

### 5.1 Problem Classes

- **Attributes:**
  - Title (unique)
  - Description (â‰¤200 words)
  - Difficulty
  - Learning objectives (required)
  - Grading criteria (required)
  - Prerequisites (optional, list of other problem classes)
  - Tags (optional)
  - Code templates (optional, e.g., starter code)
- **Limits:** Max 20 classes per teacher.

### 5.2 Problems

- **Attributes:**
  - Problem statement
  - Solution/explanation (visible only to teachers/TAs)
  - At least 10 test cases (required)
  - Starter code, hints, max attempts, deadline (optional)
- **Creation:**
  - Teachers can hand-author unlimited problems.
  - LLM batch generation (see below) is rate-limited.

---

## 6. Problem Generation (LLM Integration)

- **LLM:** Anthropic (Claude or similar), API configuration managed per teacher.
- **API Key Management:**
  - Teachers must provide own API key (encrypted in DB). No key = no LLM features.
- **Batch Generation:**
  - Teachers may generate up to 5 batches of 10 problems per problem class.
  - Teachers review, edit, and approve LLM-generated problems.
  - Teachers may hand-author additional problems beyond LLM batches.
- **Prompt Templates:** System provides creative default prompts; teachers may edit.
- **LLM-generated problems must be manually approved** before students can access.

---

## 7. Submission, Grading, and Mastery

### 7.1 Submission

- Students submit code files per assigned problem.
- File type restriction is enforced per classroom.
- Files are **processed for grading, then deleted; only test results are stored**.
- Submission history (test results, feedback, timestamps) is visible to students.

### 7.2 Grading

- **Automatic grading** via test suite (minimum 10 tests/problem).
- **Grade = % of tests passed** (e.g., 7/10 = 70%). Mastery = 100%.
- Teachers set visibility: full test suite, or only expected vs. actual output.
- Teachers/TAs can add written feedback to submissions.

### 7.3 Mastery & Progression

- Mastery is assigned at 100% (all tests passed) on the **most recent (active) problem** for a class.
- Once achieved, mastery cannot be revoked.
- Students may request a new problem if stuck; only the current active problem counts for mastery.
- Prerequisites restrict access to problem classes until mastered.

---

## 8. Grading Infrastructure & Job Status

- **Architecture:** The backend receives submissions, stores files temporarily (e.g., S3), and enqueues grading jobs.
- **Grading Jobs:**
  - Use a job queue (e.g., BullMQ, RabbitMQ, or custom Node.js queue) for scalability.
  - Workers grade code and post results back to DB.
  - If concurrency exceeds infrastructure limits, jobs queue and users may wait longer.
- **Job Status Reporting:**
  - Students see real-time status: "queued", "grading", "completed", or "error".
  - Optionally, display queue position or estimated wait time for transparency.

---

## 9. File Uploads & Security

- **Allowed File Types:** Configured per classroom; enforced server-side.
- **Upload Handling:** Files stored temporarily (e.g., S3 or local ephemeral storage), deleted immediately after grading.
- **Only test results, feedback, and metadata are persisted.**
- **Security:** Files are scanned for malware, validated for type/size before grading.

---

## 10. Audit Logging

- The system must log all critical actions:
  - User logins/logouts.
  - Creation, modification, or deletion of classrooms/problem classes/problems.
  - LLM API key changes.
  - All LLM batch generation requests and approvals.
  - Submission and grading events.
  - Role changes (TA, co-teacher assignment).
  - Settings changes (including allowed file types).
- **Logs must include:** user ID, timestamp, IP address, action, affected resource.
- **Logs must be immutable and accessible to teachers (for their own classrooms) and system admins.**

---

## 11. Additional Security & Compliance

- **API keys:** Encrypted at rest, never exposed in logs or UIs.
- **Role-based access control:** Strict enforcement; TAs/co-teachers cannot make admin changes.
- **Data privacy:** Submission code files purged after grading; only results retained.
- **Account management:** All users authenticated via username and password system.
- **Compliance:** System should be ready for FERPA/GDPR compliance review if deployed in production.

---

## 12. Frontend Requirements

- **UI for:**
  - Registration, login, and password reset.
  - Classroom creation/joining with access codes.
  - Problem class management and prerequisite mapping.
  - LLM config, batch generation, and approval workflow.
  - Submission upload with file type enforcement and job status display.
  - Viewing submission histories and feedback.
  - Role management and audit log access for teachers.
- **Accessible and responsive design** for all user roles.
- **Styling:** Use CSS, Tailwind, or Styled-Components as appropriate.

---

## 13. Backend & Infrastructure

- **Frontend:** React (Vite), hosted on GitHub Pages.
- **Backend:** React-based Node.js server (JavaScript/TypeScript), deployed as appropriate for development use.
- **Database:** MySQL (Amazon RDS).
- **File storage:** AWS S3 (for temporary uploads).
- **Job queue:** BullMQ, RabbitMQ, or similar (Node.js ecosystem).
- **LLM Integration:** Anthropic API per-teacher, with encrypted key storage.
- **Authentication:** Username and password system.
- **Audit log storage:** Immutable, queryable by teachers and admins.
- **Package management:** npm.

---

## 14. Extensibility & Future Considerations

- **LMS Integration:** (e.g., Canvas) can be added in the future.
- **Notification System:** (e.g., email, in-app) can be added in the future.
- **Support for additional languages and file types** via classroom settings.
- **Admin dashboard** for system-wide monitoring, user management, and compliance.

---

**End of Specification**